CREATE OR ALTER VIEW Departamento_Mes
AS
SELECT D.Nombre,AVG(P.SalarioNeto) PromSalarioNeto,SUM(P.TotalDeducciones) TotalDeducciones,(SELECT TOP 1 E.Nombre FROM dbo.PlanillaXMesXEmpleado P inner join dbo.Empleado E ON E.ID=P.IdEmpleado inner join dbo.MesPlanilla M ON M.ID = P.idMes ORDER BY P.SalarioNeto ASC) MejorSalario
FROM dbo.Departamentos D inner join dbo.Empleado E ON D.ID = E.IdDepartamento
inner join dbo.PlanillaXMesXEmpleado P ON E.ID = P.IdEmpleado
inner join dbo.MesPlanilla M ON M.ID = P.idMes
GROUP BY D.Nombre
